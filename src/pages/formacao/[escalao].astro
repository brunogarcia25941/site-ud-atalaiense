---
// src/pages/formacao/[escalao].astro
import Layout from '../../layouts/Layout.astro';
import PlayerCard from '../../components/PlayerCard.astro';
import jogadoresData from '../../data/jogadores.json';

// Esta função é obrigatória para rotas dinâmicas no modo estático do Astro
export async function getStaticPaths() {
  // 1. Obtemos todos os escalões únicos que NÃO são seniores
  const todosEscaloes = [...new Set(jogadoresData.map(j => j.escalao))];
  const escaloesFormacao = todosEscaloes.filter(e => e !== 'seniores');

  // 2. Para cada escalão, retornamos um objeto com os params e os dados (props)
  return escaloesFormacao.map(escalao => {
    const jogadoresDesteEscalao = jogadoresData.filter(j => j.escalao === escalao);
    return {
      params: { escalao }, // Isto define o URL (ex: /formacao/sub19)
      props: { jogadores: jogadoresDesteEscalao } // Passamos os jogadores como props
    };
  });
}

// Obtemos os dados passados pelo getStaticPaths
const { escalao } = Astro.params;
const { jogadores } = Astro.props;

// Formatação para o título (ex: sub19 -> Sub-19)
const tituloFormatado = escalao.toUpperCase().replace('SUB', 'Sub-');
---

<Layout title={`Plantel ${tituloFormatado}`}>
  <section class="max-w-7xl mx-auto px-4 py-12">
    <header class="mb-12 border-l-4 border-orange-500 pl-6">
      <h1 class="text-4xl font-black uppercase italic">Plantel {tituloFormatado}</h1>
      <p class="text-zinc-400">Formação UD Atalaiense • Época 2025/2026</p>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      {jogadores.map((jogador) => (
        <PlayerCard 
          nome={jogador.nome} 
          posicao={jogador.posicao} 
          numero={jogador.numero}
          foto={jogador.foto}
        />
      ))}
    </div>
    
    <div class="mt-12">
        <a href="/formacao" class="text-orange-500 hover:underline">← Voltar à lista de escalões</a>
    </div>
  </section>
</Layout>